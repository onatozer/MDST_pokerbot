import pyspiel
from pyspiel.universal_poker import load_universal_poker_from_acpc_gamedef
from config import *

import argparse
from cfr import CFR

import numpy as np


def calculate_exploitability(model_path):
    # Load the game environment 

    poker_variant =f"""\
GAMEDEF
nolimit
numPlayers = 2
numRounds = {NUM_CARD_STAGES}
blind = {SMALL_BLIND} {BIG_BLIND}
maxRaises = {MAX_RAISES} {MAX_RAISES}
numSuits = {NUM_SUITS}
numRanks = {NUM_RANKS}
numHoleCards = {NUM_HOLE_CARDS}
numBoardCards = {" ".join(map(str, BOARD_CARDS))}
bettingAbstraction = {BETTING_ABSTRACTION}
END GAMEDEF
"""
    game = load_universal_poker_from_acpc_gamedef(poker_variant)

    agent = CFR(game=game)
    agent.load(model_path)
    return agent.compute_exploitability()


if __name__ == '__main__':
    parser = argparse.ArgumentParser()

    parser.add_argument(
        '--load_path',
        type=str,
        default='./cfr_model.pth',
    )

    args = parser.parse_args()
    print(f"Model has an exploitability of {calculate_exploitability(args.load_path)}")
